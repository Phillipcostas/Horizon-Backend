{% extends 'base.html' %}
{% block title %}Map{% endblock %}
{% block content %}
<div class="container my-4">
  <div class="jumbotron jumbotron-fluid text-center mb-4">
    <div class="container">
      <h1 class="display-4">Where Will You Go</h1>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-lg-6 mx-auto">
      <div id="search-area" class="input-group">
        <input type="text" id="search-input" class="form-control" placeholder="Enter a location">
        <button class="btn btn-yellow ms-2" onclick="searchPlaces()">Search</button>
      </div>
    </div>
  </div>
  <div id="map" class="map-container"></div>
</div>

<script>
  let map; 
  let userLocation;
  let markers = [];

  async function initMap() {
    const mapId = "{{ map_id|escapejs }}";
    try {
      const position = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject);
      });
      userLocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      map = new google.maps.Map(document.getElementById("map"), {
        center: userLocation,
        zoom: 13,
        mapId: mapId
      });
      const marker = new google.maps.Marker({
        position: userLocation,
        map: map,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 10,
          fillColor: "#4285F4",
          fillOpacity: 1,
          strokeColor: "#ffffff",
          strokeWeight: 2
        }
      });
      marker.addListener('click', () => {
        const infoWindow = new google.maps.InfoWindow({
          content: "Your location"
        })
        infoWindow.open(map, marker);
      });
    } catch (error) {
      console.error("Error getting user location:", error);
    }
  }
  
  function clearMarkers() {
    for (let i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
    }
    markers = [];
  }

  async function searchPlaces() {
    clearMarkers();
    try {
      const query = document.getElementById("search-input").value;
      const service = new google.maps.places.PlacesService(map);
      const request = {
        location: userLocation,
        radius: 100,
        query: query
      };
      service.textSearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (let i = 0; i < results.length; i++) {
            const place = results[i];
            const marker = new google.maps.Marker({
              map: map,
              position: place.geometry.location,
              zoom: 13
            });
            markers.push(marker);
            marker.addListener('click', () => {
              const content = `<p>${place.name}</p>
                  <p>${place.formatted_address}</p>
                  <a href="https://www.google.com/maps/place/?q=place_id:${place.place_id}" target="_blank">View on Google Maps</a>
                `;
              const infoWindow = new google.maps.InfoWindow({
                content: content,
              });
              infoWindow.open(map, marker);
            });
          }
        } else {
          console.error("Error searching for places:", status);
        }
      });
    } catch (error) {
      console.error("Error in searchPlaces:", error);
    }
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{api_key}}&callback=initMap&libraries=places" async defer></script>

<style>
  .jumbotron {
    background-color: var(--yellow-color);
    color: black;
    padding: 2rem;
    border-radius: 0.5rem;
  }

  .map-container {
    height: 400px;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
  }

  #search-input {
    border-radius: 0.5rem;
  }

  .btn-yellow {
    background-color: var(--yellow-color);
    border-color: var(--yellow-color);
    color: black;
    border-radius: 0.5rem;
  }

  .social-icon {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    border-radius: 50%;
    text-align: center;
    margin-right: 10px;
    color: #fff;
  }

  .social-icon:hover {
    text-decoration: none;
  }
</style>
{% endblock %}

{% block footer %}
<footer class="bg-dark text-white py-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4 mb-4 mb-md-0">
        <h5 class="mb-3">Horizon</h5>
        <p>Discover the best travel experiences with Horizon. From luxury resorts to adventure trips, we have it all.</p>
      </div>
      <div class="col-md-4 mb-4 mb-md-0">
        <h5 class="mb-3">Quick Links</h5>
        <ul class="list-unstyled">
          <li><a href="#" class="text-white">About</a></li>
          <li><a href="#" class="text-white">Terms</a></li>
          <li><a href="#" class="text-white">Privacy</a></li>
          <li><a href="#" class="text-white">Career</a></li>
          <li><a href="#" class="text-white">Contact Us</a></li>
          <li><a href="#" class="text-white">Cookies</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h5 class="mb-3">Follow Us</h5>
        <div>
          <a href="#" class="social-icon" style="background-color: #3b5998;"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="social-icon" style="background-color: #E1306C;"><i class="fab fa-instagram"></i></a>
          <a href="#" class="social-icon" style="background-color: #1DA1F2;"><i class="fab fa-twitter"></i></a>
          <a href="#" class="social-icon" style="background-color: #0077B5;"><i class="fab fa-linkedin-in"></i></a>
        </div>
      </div>
    </div>
    <hr class="my-4">
    <p class="text-center mb-0">Copyright Â© 2024 Horizon. Built by Cool 8</p>
  </div>
</footer>
{% endblock %}
